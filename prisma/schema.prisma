generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
}

model Usuario {
  id                     String                @id @default(cuid())
  email                  String                @unique
  password               String
  nombre                 String
  apellidos              String
  telefono               String?
  dni                    String?               @unique
  numeroVoluntario       String?               @unique @map("numero_voluntario")
  avatar                 String?
  responsableTurno       Boolean               @default(false) @map("responsable_turno")
  carnetConducir         Boolean               @default(false) @map("carnet_conducir")
  experiencia            String                @default("MEDIA")
  nivelCompromiso        String                @default("MEDIO") @map("nivel_compromiso")
  activo                 Boolean               @default(true)
  rolId                  String                @map("rol_id")
  servicioId             String                @map("servicio_id")
  createdAt              DateTime              @default(now()) @map("created_at")
  updatedAt              DateTime              @updatedAt @map("updated_at")
  lastLogin              DateTime?             @map("last_login")
  asignacionesVestuario  AsignacionVestuario[]
  dietas                 Dieta[]
  disponibilidades       Disponibilidad[]
  eventosCreados         Evento[]              @relation("EventoCreador")
  eventosAsignados       EventoParticipante[]
  fichaVoluntario        FichaVoluntario?
  guardias               Guardia[]
  historialPeticiones    HistorialPeticion[]
  incidenciasAsignadas   Incidencia[]          @relation("IncidenciaAsignado")
  incidenciasCreadas     Incidencia[]          @relation("IncidenciaCreador")
  mensajesRecibidos      Mensaje[]             @relation("MensajesRecibidos")
  mensajesEnviados       Mensaje[]             @relation("MensajesEnviados")
  movimientosStock       MovimientoStock[]
  notificaciones         Notificacion[]
  peticionesAprobadas    PeticionMaterial[]    @relation("PeticionesAprobadas")
  peticionesRecibidas    PeticionMaterial[]    @relation("PeticionesRecibidas")
  peticionesSolicitadas  PeticionMaterial[]    @relation("PeticionesSolicitadas")
  revisionesRealizadas   RevisionBotiquin[]
  solicitudesRespondidas SolicitudVestuario[]  @relation("SolicitudesRespondidas")
  solicitudesVestuario   SolicitudVestuario[]
  rol                    Rol                   @relation(fields: [rolId], references: [id])
  servicio               Servicio              @relation(fields: [servicioId], references: [id])
  vehiculosAsignados     VehiculoAsignacion[]
  documentosVehiculo    DocumentoVehiculo[]
  mantenimientosVehiculo MantenimientoVehiculo[]

  manuales              Manual[]
  partesPSI             PartePSI[]
  inscripciones         Inscripcion[]
  firmasAsistencia      RegistroFirma[]        @relation("FirmasUsuario")
  certificaciones        Certificacion[]

  @@map("usuarios")
}

model Rol {
  id          String    @id @default(cuid())
  nombre      String    @unique
  descripcion String?
  permisos    Json
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  usuarios    Usuario[]

  @@map("roles")
}

model Servicio {
  id          String       @id @default(cuid())
  nombre      String
  codigo      String       @unique
  direccion   String?
  telefono    String?
  email       String?
  logo        String?
  activo      Boolean      @default(true)
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  articulos   Articulo[]
  eventos     Evento[]
  guardias    Guardia[]
  incidencias Incidencia[]
  ubicaciones Ubicacion[]
  usuarios    Usuario[]
  vehiculos   Vehiculo[]

  @@map("servicios")
}

model Evento {
  id                  String               @id @default(cuid())
  titulo              String
  descripcion         String?
  tipo                String
  fecha               DateTime             @db.Date
  horaInicio          String               @map("hora_inicio")
  horaFin             String?              @map("hora_fin")
  todoElDia           Boolean              @default(false) @map("todo_el_dia")
  ubicacion           String?
  direccion           String?
  coordenadas         Json?
  estado              String               @default("programado")
  visible             Boolean              @default(true)
  privado             Boolean              @default(false)
  voluntariosMin      Int?                 @map("voluntarios_min")
  voluntariosMax      Int?                 @map("voluntarios_max")
  vehiculosNecesarios String?              @map("vehiculos_necesarios")
  color               String?
  creadorId           String               @map("creador_id")
  servicioId          String               @map("servicio_id")
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  creador             Usuario              @relation("EventoCreador", fields: [creadorId], references: [id])
  servicio            Servicio             @relation(fields: [servicioId], references: [id])
  participantes       EventoParticipante[]

  @@map("eventos")
}

model EventoParticipante {
  id        String   @id @default(cuid())
  eventoId  String   @map("evento_id")
  usuarioId String   @map("usuario_id")
  estado    String   @default("asignado")
  rol       String?
  notas     String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  evento    Evento   @relation(fields: [eventoId], references: [id], onDelete: Cascade)
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])

  @@unique([eventoId, usuarioId])
  @@map("eventos_participantes")
}

model Disponibilidad {
  id              String   @id @default(cuid())
  semanaInicio    DateTime @map("semana_inicio") @db.Date
  usuarioId       String   @map("usuario_id")
  noDisponible    Boolean  @default(false) @map("no_disponible")
  detalles        Json     @default("{}")
  turnosDeseados  Int      @default(1) @map("turnos_deseados")
  puedeDobleturno Boolean  @default(false) @map("puede_dobleturno")
  notas           String?
  estado          String   @default("pendiente")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  usuario         Usuario  @relation(fields: [usuarioId], references: [id])

  @@unique([usuarioId, semanaInicio])
  @@map("disponibilidades")
}

model CategoriaInventario {
  id          String                @id @default(cuid())
  nombre      String
  slug        String                @unique
  descripcion String?
  icono       String?
  color       String?
  orden       Int                   @default(0)
  activa      Boolean               @default(true)
  padreId     String?               @map("padre_id")
  esGeneral   Boolean               @default(false) @map("es_general")
  createdAt   DateTime              @default(now()) @map("created_at")
  updatedAt   DateTime              @updatedAt @map("updated_at")
  padre       CategoriaInventario?  @relation("CategoriaJerarquia", fields: [padreId], references: [id])
  hijos       CategoriaInventario[] @relation("CategoriaJerarquia")
  familias    FamiliaArticulo[]

  @@map("categorias_inventario")
}

model FamiliaArticulo {
  id          String              @id @default(cuid())
  nombre      String
  slug        String
  descripcion String?
  categoriaId String              @map("categoria_id")
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")
  articulos   Articulo[]
  categoria   CategoriaInventario @relation(fields: [categoriaId], references: [id])

  @@unique([categoriaId, slug])
  @@map("familias_articulo")
}

model Articulo {
  id             String             @id @default(cuid())
  codigo         String?
  nombre         String
  descripcion    String?
  stockActual    Int                @default(0) @map("stock_actual")
  stockMinimo    Int                @default(0) @map("stock_minimo")
  unidad         String             @default("unidad")
  tieneCaducidad Boolean            @default(false) @map("tiene_caducidad")
  fechaCaducidad DateTime?          @map("fecha_caducidad")
  ubicacionId    String?            @map("ubicacion_id")
  familiaId      String             @map("familia_id")
  servicioId     String             @map("servicio_id")
  metadatos      Json?
  activo         Boolean            @default(true)
  createdAt      DateTime           @default(now()) @map("created_at")
  updatedAt      DateTime           @updatedAt @map("updated_at")
  stockAsignado  Int                @default(0) @map("stock_asignado")
  familia        FamiliaArticulo    @relation(fields: [familiaId], references: [id])
  servicio       Servicio           @relation(fields: [servicioId], references: [id])
  ubicacion      Ubicacion?         @relation(fields: [ubicacionId], references: [id])
  botiquinItems  BotiquinItem[]
  movimientos    MovimientoStock[]
  peticiones     PeticionMaterial[]

  @@unique([servicioId, codigo])
  @@map("articulos")
}

model Ubicacion {
  id          String      @id @default(cuid())
  nombre      String
  tipo        String
  descripcion String?
  padreId     String?     @map("padre_id")
  servicioId  String      @map("servicio_id")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  articulos   Articulo[]
  padre       Ubicacion?  @relation("UbicacionJerarquia", fields: [padreId], references: [id])
  hijos       Ubicacion[] @relation("UbicacionJerarquia")
  servicio    Servicio    @relation(fields: [servicioId], references: [id])

  @@map("ubicaciones")
}

model MovimientoStock {
  id         String   @id @default(cuid())
  tipo       String
  cantidad   Int
  motivo     String?
  notas      String?
  articuloId String   @map("articulo_id")
  usuarioId  String   @map("usuario_id")
  createdAt  DateTime @default(now()) @map("created_at")
  articulo   Articulo @relation(fields: [articuloId], references: [id])
  usuario    Usuario  @relation(fields: [usuarioId], references: [id])

  @@map("movimientos_stock")
}

model Vehiculo {
  id           String               @id @default(cuid())
  matricula    String               @unique
  indicativo   String?
  tipo         String
  marca        String?
  modelo       String?
  anio         Int?                 @map("anio")
  estado       String               @default("disponible")
  kmActual     Int?                 @map("km_actual")
  fechaItv     DateTime?            @map("fecha_itv")
  fechaSeguro  DateTime?            @map("fecha_seguro")
  servicioId   String               @map("servicio_id")
  createdAt    DateTime             @default(now()) @map("created_at")
  updatedAt    DateTime             @updatedAt @map("updated_at")
  botiquines   Botiquin[]
  servicio     Servicio             @relation(fields: [servicioId], references: [id])
  asignaciones VehiculoAsignacion[]
  documentos      DocumentoVehiculo[]
  mantenimientos  MantenimientoVehiculo[]

  @@map("vehiculos")
}

model VehiculoAsignacion {
  id          String    @id @default(cuid())
  vehiculoId  String    @map("vehiculo_id")
  usuarioId   String    @map("usuario_id")
  fechaInicio DateTime  @map("fecha_inicio")
  fechaFin    DateTime? @map("fecha_fin")
  kmInicio    Int?      @map("km_inicio")
  kmFin       Int?      @map("km_fin")
  motivo      String?
  createdAt   DateTime  @default(now()) @map("created_at")
  usuario     Usuario   @relation(fields: [usuarioId], references: [id])
  vehiculo    Vehiculo  @relation(fields: [vehiculoId], references: [id])

  @@map("vehiculos_asignaciones")
}

model Guardia {
  id         String   @id @default(cuid())
  fecha      DateTime @db.Date
  turno      String
  rol        String?  // Rol del voluntario: Conductor, Responsable, Interviniente, Apoyo/Cecopal, Cecopal
  tipo       String
  notas      String?
  usuarioId  String   @map("usuario_id")
  servicioId String   @map("servicio_id")
  estado     String   @default("programada")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  servicio   Servicio @relation(fields: [servicioId], references: [id])
  usuario    Usuario  @relation(fields: [usuarioId], references: [id])

  @@unique([usuarioId, fecha, turno])
  @@map("guardias")
}

model Incidencia {
  id          String    @id @default(cuid())
  numero      String    @unique
  titulo      String
  descripcion String?
  tipo        String
  prioridad   String    @default("normal")
  estado      String    @default("abierta")
  direccion   String?
  coordenadas Json?
  fechaInicio DateTime  @default(now()) @map("fecha_inicio")
  fechaFin    DateTime? @map("fecha_fin")
  creadorId   String    @map("creador_id")
  asignadoId  String?   @map("asignado_id")
  servicioId  String    @map("servicio_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  asignado    Usuario?  @relation("IncidenciaAsignado", fields: [asignadoId], references: [id])
  creador     Usuario   @relation("IncidenciaCreador", fields: [creadorId], references: [id])
  servicio    Servicio  @relation(fields: [servicioId], references: [id])

  @@map("incidencias")
}

model Configuracion {
  id          String   @id @default(cuid())
  clave       String   @unique
  valor       Json
  descripcion String?
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("configuracion")
}

model FichaVoluntario {
  id                     String    @id @default(cuid())
  usuarioId              String    @unique @map("usuario_id")
  indicativo2            String?   @map("indicativo_2")
  fechaAlta              DateTime? @map("fecha_alta") @db.Date
  fechaBaja              DateTime? @map("fecha_baja") @db.Date
  fechaNacimiento        DateTime? @map("fecha_nacimiento") @db.Date
  edad                   Int?
  sexo                   String?
  domicilio              String?
  numero                 String?
  bloque                 String?
  piso                   String?
  puerta                 String?
  letra                  String?
  codigoPostal           String?   @map("codigo_postal")
  localidad              String?
  provincia              String?
  telefonoFijo           String?   @map("telefono_fijo")
  dniNie                 String?   @map("dni_nie")
  areaAsignada           String?   @map("area_asignada")
  categoria              String?
  permisoConducir        String?   @map("permiso_conducir")
  fechaExpedicion        DateTime? @map("fecha_expedicion") @db.Date
  fechaValidez           DateTime? @map("fecha_validez") @db.Date
  formacionProfesional   String?   @map("formacion_profesional")
  ocupacionActual        String?   @map("ocupacion_actual")
  minusvaliaReconocida   String?   @map("minusvalia_reconocida")
  datosAlergias          String?   @map("datos_alergias")
  grupoSanguineo         String?   @map("grupo_sanguineo")
  contactoEmergencia     String?   @map("contacto_emergencia")
  telefonoEmergencia     String?   @map("telefono_emergencia")
  formacionPC            Json?     @default("[]") @map("formacion_pc")
  otrasTitulaciones      String?   @map("otras_titulaciones")
  acuerdoIndividual      Boolean   @default(false) @map("acuerdo_individual")
  acuerdoAdjunto         String?   @map("acuerdo_adjunto")
  certificadoTitularidad Boolean   @default(false) @map("certificado_titularidad")
  certificadoAdjunto     String?   @map("certificado_adjunto")
  modelo145              Boolean   @default(false) @map("modelo_145")
  modelo145Adjunto       String?   @map("modelo_145_adjunto")
  createdAt              DateTime  @default(now()) @map("created_at")
  updatedAt              DateTime  @updatedAt @map("updated_at")
  usuario                Usuario   @relation(fields: [usuarioId], references: [id])

  @@map("fichas_voluntario")
}

model Dieta {
  id              String   @id @default(cuid())
  usuarioId       String   @map("usuario_id")
  guardiaId       String?  @map("guardia_id")
  fecha           DateTime @db.Date
  turno           String
  horasTrabajadas Decimal  @default(0) @map("horas_trabajadas") @db.Decimal(4, 2)
  importeDia      Decimal  @default(29.45) @map("importe_dia") @db.Decimal(8, 2)
  subtotalDietas  Decimal  @default(0) @map("subtotal_dietas") @db.Decimal(8, 2)
  kilometros      Decimal  @default(0) @db.Decimal(8, 2)
  importeKm       Decimal  @default(0.19) @map("importe_km") @db.Decimal(4, 2)
  subtotalKm      Decimal  @default(0) @map("subtotal_km") @db.Decimal(8, 2)
  totalDieta      Decimal  @default(0) @map("total_dieta") @db.Decimal(8, 2)
  mesAnio         String   @map("mes_anio")
  estado          String   @default("pendiente")
  notas           String?
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  usuario         Usuario  @relation(fields: [usuarioId], references: [id])

  @@map("dietas")
}

model MovimientoCaja {
  id             String   @id @default(cuid())
  fecha          DateTime @db.Date
  tipo           String
  concepto       String
  descripcion    String?
  importe        Decimal  @db.Decimal(10, 2)
  saldoAnterior  Decimal  @map("saldo_anterior") @db.Decimal(10, 2)
  saldoPosterior Decimal  @map("saldo_posterior") @db.Decimal(10, 2)
  categoria      String?
  adjuntoUrl     String?  @map("adjunto_url")
  adjuntoNombre  String?  @map("adjunto_nombre")
  registradoPor  String   @map("registrado_por")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  @@map("movimientos_caja")
}

model TicketCombustible {
  id              String   @id @default(cuid())
  fecha           DateTime @db.Date
  hora            String?
  estacion        String?
  numeroTarjeta   String?  @map("numero_tarjeta")
  destino         String
  concepto        String
  litros          Decimal  @db.Decimal(8, 2)
  precioLitro     Decimal  @map("precio_litro") @db.Decimal(6, 4)
  importeSinDto   Decimal  @map("importe_sin_dto") @db.Decimal(8, 2)
  descuento       Decimal  @default(0) @db.Decimal(8, 2)
  importeFinal    Decimal  @map("importe_final") @db.Decimal(8, 2)
  vehiculoDestino String?  @map("vehiculo_destino")
  ticketUrl       String?  @map("ticket_url")
  ticketNombre    String?  @map("ticket_nombre")
  mesAnio         String   @map("mes_anio")
  registradoPor   String   @map("registrado_por")
  notas           String?
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("tickets_combustible")
}

model Poliza {
  id               String   @id @default(cuid())
  tipo             String
  numero           String?  @map("numero_poliza")
  compania         String
  descripcion      String?
  fechaInicio      DateTime @map("fecha_inicio") @db.Date
  fechaVencimiento DateTime @map("fecha_vencimiento") @db.Date
  primaAnual       Decimal? @map("prima_anual") @db.Decimal(10, 2)
  estado           String   @default("vigente")
  vehiculoId       String?  @map("vehiculo_id")
  documentoUrl     String?  @map("documento_url")
  notas            String?
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  @@map("polizas")
}

model PeticionMaterial {
  id              String              @id @default(cuid())
  numero          String              @unique
  solicitanteId   String              @map("solicitante_id")
  areaOrigen      String              @map("area_origen")
  articuloId      String?             @map("articulo_id")
  nombreArticulo  String              @map("nombre_articulo")
  cantidad        Int
  unidad          String              @default("unidad")
  motivo          String
  prioridad       String              @default("normal")
  descripcion     String?
  estado          String              @default("pendiente")
  fechaSolicitud  DateTime            @default(now()) @map("fecha_solicitud")
  fechaAprobacion DateTime?           @map("fecha_aprobacion")
  fechaCompra     DateTime?           @map("fecha_compra")
  fechaRecepcion  DateTime?           @map("fecha_recepcion")
  aprobadoPorId   String?             @map("aprobado_por_id")
  recibidoPorId   String?             @map("recibido_por_id")
  notasAprobacion String?             @map("notas_aprobacion")
  notasCompra     String?             @map("notas_compra")
  notasRecepcion  String?             @map("notas_recepcion")
  motivoRechazo   String?             @map("motivo_rechazo")
  proveedor       String?
  numeroFactura   String?             @map("numero_factura")
  costeEstimado   Decimal?            @map("coste_estimado") @db.Decimal(10, 2)
  costeFinal      Decimal?            @map("coste_final") @db.Decimal(10, 2)
  createdAt       DateTime            @default(now()) @map("created_at")
  updatedAt       DateTime            @updatedAt @map("updated_at")
  historial       HistorialPeticion[]
  notificaciones  Notificacion[]
  aprobadoPor     Usuario?            @relation("PeticionesAprobadas", fields: [aprobadoPorId], references: [id])
  articulo        Articulo?           @relation(fields: [articuloId], references: [id])
  recibidoPor     Usuario?            @relation("PeticionesRecibidas", fields: [recibidoPorId], references: [id])
  solicitante     Usuario             @relation("PeticionesSolicitadas", fields: [solicitanteId], references: [id])

  @@map("peticiones_material")
}

model HistorialPeticion {
  id             String           @id @default(cuid())
  peticionId     String           @map("peticion_id")
  estadoAnterior String?          @map("estado_anterior")
  estadoNuevo    String           @map("estado_nuevo")
  comentario     String?
  usuarioId      String           @map("usuario_id")
  createdAt      DateTime         @default(now()) @map("created_at")
  peticion       PeticionMaterial @relation(fields: [peticionId], references: [id], onDelete: Cascade)
  usuario        Usuario          @relation(fields: [usuarioId], references: [id])

  @@map("historial_peticiones")
}

model Notificacion {
  id         String            @id @default(cuid())
  tipo       String
  titulo     String
  mensaje    String
  enlace     String?
  leida      Boolean           @default(false)
  usuarioId  String            @map("usuario_id")
  peticionId String?           @map("peticion_id")
  createdAt  DateTime          @default(now()) @map("created_at")
  peticion   PeticionMaterial? @relation(fields: [peticionId], references: [id])
  usuario    Usuario           @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([usuarioId, leida])
  @@map("notificaciones")
}

model Mensaje {
  id                String    @id @default(cuid())
  asunto            String
  contenido         String
  tipo              String    @default("mensaje")
  prioridad         String    @default("normal")
  leido             Boolean   @default(false)
  archivado         Boolean   @default(false)
  remitenteId       String    @map("remitente_id")
  destinatarioId    String?   @map("destinatario_id")
  destinatarioGrupo String?   @map("destinatario_grupo")
  mensajePadreId    String?   @map("mensaje_padre_id")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  destinatario      Usuario?  @relation("MensajesRecibidos", fields: [destinatarioId], references: [id])
  mensajePadre      Mensaje?  @relation("HiloMensajes", fields: [mensajePadreId], references: [id])
  respuestas        Mensaje[] @relation("HiloMensajes")
  remitente         Usuario   @relation("MensajesEnviados", fields: [remitenteId], references: [id])

  @@index([destinatarioId, leido])
  @@index([remitenteId])
  @@map("mensajes")
}

model Edificio {
  id          String      @id @default(cuid())
  nombre      String      @unique
  direccion   String?
  responsable String?
  telefono    String?
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  deas        DEA[]
  equiposECI  EquipoECI[]

  @@map("edificios")
}

model EquipoECI {
  id               String    @id @default(cuid())
  edificioId       String    @map("edificio_id")
  tipo             String
  subtipo          String?
  ubicacion        String
  numeroSerie      String?   @map("numero_serie")
  estado           String    @default("operativo")
  fechaInstalacion DateTime? @map("fecha_instalacion")
  ultimaRevision   DateTime? @map("ultima_revision")
  proximaRevision  DateTime? @map("proxima_revision")
  observaciones    String?
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")
  edificio         Edificio  @relation(fields: [edificioId], references: [id], onDelete: Cascade)

  @@index([edificioId])
  @@index([estado])
  @@index([proximaRevision])
  @@map("equipos_eci")
}

model Hidrante {
  id               String    @id @default(cuid())
  codigo           String    @unique
  tipo             String
  ubicacion        String
  latitud          Float?
  longitud         Float?
  presion          Float?
  caudal           Int?
  estado           String    @default("operativo")
  fechaInstalacion DateTime? @map("fecha_instalacion")
  ultimaRevision   DateTime? @map("ultima_revision")
  proximaRevision  DateTime? @map("proxima_revision")
  observaciones    String?
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")

  @@index([estado])
  @@map("hidrantes")
}

model AsignacionVestuario {
  id                    String               @id @default(cuid())
  usuarioId             String               @map("usuario_id")
  tipoPrenda            String               @map("tipo_prenda")
  talla                 String
  cantidad              Int                  @default(1)
  fechaAsignacion       DateTime             @default(now()) @map("fecha_asignacion")
  fechaBaja             DateTime?            @map("fecha_baja")
  estado                String               @default("asignado")
  observaciones         String?
  createdAt             DateTime             @default(now()) @map("created_at")
  updatedAt             DateTime             @updatedAt @map("updated_at")
  usuario               Usuario              @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  solicitudesReposicion SolicitudVestuario[] @relation("SolicitudesReposicion")
  solicitudGenerada     SolicitudVestuario?  @relation("AsignacionGenerada")

  @@index([usuarioId])
  @@index([estado])
  @@map("asignaciones_vestuario")
}

model SolicitudVestuario {
  id                   String               @id @default(cuid())
  usuarioId            String               @map("usuario_id")
  tipoPrenda           String               @map("tipo_prenda")
  talla                String
  cantidad             Int                  @default(1)
  asignacionAnteriorId String?              @map("asignacion_anterior_id")
  asignacionGeneradaId String?              @unique @map("asignacion_generada_id")
  motivo               String
  descripcion          String?
  estado               String               @default("pendiente")
  fechaSolicitud       DateTime             @default(now()) @map("fecha_solicitud")
  fechaRespuesta       DateTime?            @map("fecha_respuesta")
  respuestaPorId       String?              @map("respuesta_por_id")
  comentarioRespuesta  String?              @map("comentario_respuesta")
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  asignacionAnterior   AsignacionVestuario? @relation("SolicitudesReposicion", fields: [asignacionAnteriorId], references: [id])
  asignacionGenerada   AsignacionVestuario? @relation("AsignacionGenerada", fields: [asignacionGeneradaId], references: [id])
  respuestaPor         Usuario?             @relation("SolicitudesRespondidas", fields: [respuestaPorId], references: [id])
  usuario              Usuario              @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([usuarioId])
  @@index([estado])
  @@index([fechaSolicitud])
  @@map("solicitudes_vestuario")
}

model DEA {
  id               String    @id @default(cuid())
  codigo           String    @unique
  tipo             String
  marca            String?
  modelo           String?
  numeroSerie      String?   @map("numero_serie")
  ubicacion        String
  edificioId       String?   @map("edificio_id")
  latitud          Float?
  longitud         Float?
  fechaInstalacion DateTime? @map("fecha_instalacion") @db.Date
  fechaRevision    DateTime? @map("fecha_revision") @db.Date
  proximaRevision  DateTime? @map("proxima_revision") @db.Date
  estado           String    @default("operativo")
  accesible24h     Boolean   @default(true) @map("accesible_24h")
  observaciones    String?
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")
  caducidadBateria DateTime?
  caducidadParches DateTime?
  caducidadPilas   DateTime?
  edificio         Edificio? @relation(fields: [edificioId], references: [id])

  @@map("deas")
}

model Botiquin {
  id              String             @id @default(cuid())
  codigo          String             @unique
  nombre          String
  tipo            String
  ubicacionActual String             @map("ubicacion_actual")
  vehiculoId      String?            @map("vehiculo_id")
  estado          String             @default("operativo")
  ultimaRevision  DateTime?          @map("ultima_revision")
  proximaRevision DateTime?          @map("proxima_revision")
  observaciones   String?
  createdAt       DateTime           @default(now()) @map("created_at")
  updatedAt       DateTime           @updatedAt @map("updated_at")
  items           BotiquinItem[]
  vehiculo        Vehiculo?          @relation(fields: [vehiculoId], references: [id])
  revisiones      RevisionBotiquin[]

  @@index([tipo])
  @@index([estado])
  @@index([vehiculoId])
  @@map("botiquines")
}

model BotiquinItem {
  id                String    @id @default(cuid())
  botiquinId        String    @map("botiquin_id")
  articuloId        String?   @map("articulo_id")
  nombreItem        String    @map("nombre_item")
  cantidadRequerida Int       @map("cantidad_requerida")
  cantidadActual    Int       @default(0) @map("cantidad_actual")
  caducidad         DateTime?
  unidad            String    @default("Unidad")
  verificado        Boolean   @default(false)
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  articulo          Articulo? @relation(fields: [articuloId], references: [id])
  botiquin          Botiquin  @relation(fields: [botiquinId], references: [id], onDelete: Cascade)

  @@index([botiquinId])
  @@index([caducidad])
  @@map("botiquin_items")
}

model RevisionBotiquin {
  id               String   @id @default(cuid())
  botiquinId       String   @map("botiquin_id")
  usuarioId        String   @map("usuario_id")
  fecha            DateTime @default(now())
  itemsVerificados Int      @default(0) @map("items_verificados")
  itemsFaltantes   Int      @default(0) @map("items_faltantes")
  itemsCaducados   Int      @default(0) @map("items_caducados")
  observaciones    String?
  createdAt        DateTime @default(now()) @map("created_at")
  botiquin         Botiquin @relation(fields: [botiquinId], references: [id], onDelete: Cascade)
  usuario          Usuario  @relation(fields: [usuarioId], references: [id])

  @@index([botiquinId])
  @@index([usuarioId])
  @@index([fecha])
  @@map("revisiones_botiquin")
}

enum TipoHidrante {
  COLUMNA
  ARQUETA
}

enum EstadoHidrante {
  OPERATIVO
  AVERIADO
  FUERA_SERVICIO
}

enum TipoPrenda {
  POLO
  PANTALON
  CHAQUETA
  BOTAS
  CASCO
  GUANTES
}

enum Talla {
  XS
  S
  M
  L
  XL
  XXL
  XXXL
}

enum EstadoAsignacion {
  ASIGNADO
  DESGASTADO
  PERDIDO
  DADO_DE_BAJA
}

enum MotivoSolicitud {
  NUEVA_ASIGNACION
  REPOSICION
  ROTURA
  PERDIDA
  DESGASTE
  CAMBIO_TALLA
}

enum EstadoSolicitud {
  PENDIENTE
  APROBADA
  RECHAZADA
  ENTREGADA
  CANCELADA
}

model DocumentoVehiculo {
  id           String   @id @default(cuid())
  vehiculoId   String
  vehiculo     Vehiculo @relation(fields: [vehiculoId], references: [id], onDelete: Cascade)
  tipo         String   // 'itv', 'seguro', 'permiso_circulacion', 'otros'
  nombre       String
  url          String   // URL del archivo en Vercel Blob
  blobKey      String   // Key para eliminar de Vercel Blob
  fechaSubida  DateTime @default(now())
  usuarioId    String
  usuario      Usuario  @relation(fields: [usuarioId], references: [id])
  
  @@index([vehiculoId])
  @@index([usuarioId])
  @@map("documentos_vehiculo")
}

model MantenimientoVehiculo {
  id              String    @id @default(cuid())
  vehiculoId      String
  vehiculo        Vehiculo  @relation(fields: [vehiculoId], references: [id], onDelete: Cascade)
  fecha           DateTime
  tipo            String    // 'revision', 'reparacion', 'cambio_aceite', 'neumaticos', 'itv', 'otros'
  descripcion     String
  kilometraje     Int?
  coste           Float?
  proximaRevision DateTime?
  realizadoPor    String?   // Taller o persona
  observaciones   String?
  usuarioId       String
  usuario         Usuario   @relation(fields: [usuarioId], references: [id])
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([vehiculoId])
  @@index([usuarioId])
  @@index([fecha])
  @@map("mantenimientos_vehiculo")
}

model EquipoRadio {
  id                    String    @id @default(cuid())
  codigo                String    @unique // TR-01, TR-02, etc.
  tipo                  String    // portatil, movil, base, repetidor
  marca                 String
  modelo                String
  numeroSerie           String?
  configuracion         String    // analogico, dmr, tetra
  estado                String    @default("disponible") // disponible, en_carga, averiado, mantenimiento
  
  // Batería
  estadoBateria         Int?      // Porcentaje de salud (0-100)
  fechaInstalacionBat   DateTime?
  ciclosCarga           Int       @default(0)
  
  // Configuración RF - Modo Analógico
  freqTxAnalogico       Float?    // MHz
  freqRxAnalogico       Float?    // MHz
  subtonoTx             String?   // CTCSS Hz (ej: "67.0", "71.9")
  subtonoRx             String?   // CTCSS Hz
  potenciaAnalogico     Float?    // Watts

  // Configuración RF - Modo Digital (DMR/Repetidor)
  freqTxDigital         Float?    // MHz
  freqRxDigital         Float?    // MHz
  colorCode             Int?
  timeslot              Int?      // 1 o 2
  potenciaDigital       Float?    // Watts

  // General RF
  potenciaMaxima        Float?    // Watts máx del equipo
  bandaFrecuencia       String?   // VHF, UHF
  canalAnalogico        String?   // Nombre del canal
  canalDigital          String?   // Nombre del canal digital
  
  // Coordenadas (para base, repetidor)
  latitud               Float?
  longitud              Float?
  alturaAntena          Float?    // metros
  
  // Cobertura estimada
  radioCobertura        Float?    // km estimados

  // Ubicación y notas
  ubicacion             String?
  observaciones         String?
  
  // Timestamps
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  // Relaciones
  mantenimientos        MantenimientoEquipo[]
  ciclosCargaHistorial  CicloCarga[]
}

model MantenimientoEquipo {
  id                String    @id @default(cuid())
  equipoId          String
  tipo              String    // revision, reparacion, cambio_bateria, actualizacion_firmware
  descripcion       String
  fecha             DateTime  @default(now())
  realizadoPor      String?
  coste             Float?
  observaciones     String?
  
  equipo            EquipoRadio @relation(fields: [equipoId], references: [id], onDelete: Cascade)
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

model CicloCarga {
  id                String    @id @default(cuid())
  equipoId          String
  fechaInicio       DateTime  @default(now())
  fechaFin          DateTime?
  duracionHoras     Float?
  nivelInicial      Int?      // % batería al conectar
  nivelFinal        Int?      // % batería al desconectar
  observaciones     String?
  
  equipo            EquipoRadio @relation(fields: [equipoId], references: [id], onDelete: Cascade)
  
  createdAt         DateTime  @default(now())
}
model Manual {
  id          String   @id @default(cuid())
  titulo      String
  descripcion String?
  categoria   String   // incendios, socorrismo, vehiculos, transmisiones, pma, general
  tipo        String?  // manual_usuario, ficha_tecnica, procedimiento, guia_rapida
  fabricante  String?
  modelo      String?
  url         String   // URL del blob
  blobKey     String   // Key para eliminar de blob
  nombreArchivo String @map("nombre_archivo")
  tamano      Int      // Tamaño en bytes
  usuarioId   String   @map("usuario_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
  
  @@map("manuales")
}




model PartePSI {
  id                        String    @id @default(cuid())
  numeroParte               String    @unique // 20260211-001
  fecha                     DateTime  @default(now())
  estado                    String    @default("pendiente_vb") // "pendiente_vb" | "completo"
  archivado                 Boolean   @default(false)
  
  // Pautas de tiempo (formato HH:mm como String)
  horaLlamada               String?
  horaSalida                String?
  horaLlegada               String?
  horaTerminado             String?
  horaDisponible            String?
  
  // Datos principales
  lugar                     String
  motivo                    String?
  alertante                 String?
  circulacion               String? // "prevencion" | "intervencion" | "otros"
  matriculasImplicados      String?
  
  // Arrays JSON
  vehiculosIds              Json // ["vehiculoId1", "vehiculoId2"]
  equipoWalkies             Json // [{equipo: "B-13", walkie: "W-01"}, {equipo: "B-15", walkie: "W-02"}]
  tipologias                Json // ["mantenimiento", "soporte_vital", "otros_grupo1"]
  tipologiasOtrosTexto      Json // {grupo1: "Texto otros grupo 1", grupo2: "", grupo3: ""}
  
  // Autoridades
  policiaLocal              String? // Texto del campo "Policía Local de..."
  guardiaCivil              String? // Texto del campo "Guardia Civil de..."
  
  // Accidente
  posiblesCausas            String?
  tieneHeridos              Boolean   @default(false)
  numeroHeridos             Int?
  tieneFallecidos           Boolean   @default(false)
  numeroFallecidos          Int?
  indicativosInforman       String?
  descripcionAccidente      String?
  
  // Contenido
  observaciones             String @db.Text // Página 1 - Resumen
  desarrolloDetallado       String @db.Text // Página 2 - Detalle completo
  fotosUrls                 Json // ["https://blob.vercel.com/foto1.jpg", "..."] - Página 3
  
  // Firmas (base64 PNG dataURL)
  indicativoCumplimenta     String? // Indicativo seleccionado (ej: "B-13")
  firmaIndicativoCumplimenta String? @db.Text // "data:image/png;base64,iVBORw0KG..."
  responsableTurno          String? // Indicativo seleccionado (ej: "B-15")
  firmaResponsableTurno     String? @db.Text // "data:image/png;base64,iVBORw0KG..."
  firmaJefeServicio         String? @db.Text // "data:image/png;base64,iVBORw0KG..." o certificado digital
  tipoFirmaJefe             String? // "biometrica" | "certificado_digital"
  
  // PDF generado
  pdfUrl                    String? // URL del PDF en Vercel Blob
  pdfGenerado               Boolean   @default(false)

  // Google Drive Backup
  googleDriveId             String?   // ID del archivo en Google Drive
  googleDriveUrl            String?   // URL pública en Google Drive
  
  // Auditoría
  creadoPorId               String
  creadoPor                 Usuario   @relation(fields: [creadoPorId], references: [id])
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime  @updatedAt
  
  @@index([numeroParte])
  @@index([fecha])
  @@index([estado])
  @@index([archivado])
  @@index([creadoPorId])
  @@map("partes_psi")
}

model Aspirante {
  id                      String    @id @default(cuid())
  fecha                   DateTime  @default(now())
  nombre                  String
  apellidos               String
  dni                     String    @unique
  telefono                String?
  email                   String?
  estado                  String    @default("pendiente")
  
  fechaEntrevista         DateTime? @map("fecha_entrevista")
  confirmacionAsistencia  Boolean   @default(false) @map("confirmacion_asistencia")
  asistioEntrevista       Boolean   @default(false) @map("asistio_entrevista")
  evaluacionEntrevista    String?   @db.Text @map("evaluacion_entrevista")
  
  carneConducir           String?   @map("carne_conducir")
  formacion               String?   @db.Text
  ocupacionActual         String?   @map("ocupacion_actual")
  tiempoLibre             String?   @db.Text @map("tiempo_libre")
  interesServicio         String?   @db.Text @map("interes_servicio")
  
  observaciones           String?   @db.Text
  
  createdAt               DateTime  @default(now()) @map("created_at")
  updatedAt               DateTime  @updatedAt @map("updated_at")
  
  @@index([estado])
  @@index([fecha])
  @@map("aspirantes")
}

// ============================================
// MÓDULO DE FORMACIÓN
// ============================================

model Curso {
  id                String   @id @default(cuid())
  codigo            String   @unique
  nombre            String
  descripcion       String?  @db.Text
  tipo              String
  duracionHoras     Int      @map("duracion_horas")
  validezMeses      Int?     @map("validez_meses")
  
  objetivos         String?  @db.Text
  temario           String?  @db.Text
  requisitosAcceso  String?  @db.Text @map("requisitos_acceso")
  documentacion     String?  @db.Text
  
  entidadOrganiza   String?  @map("entidad_organiza")
  entidadCertifica  String?  @map("entidad_certifica")
  costoPorAlumno    Float?   @default(0) @map("costo_por_alumno")
  plazasMaximas     Int?     @map("plazas_maximas")
  
  // Nuevos campos
  areaVinculada     String?  @map("area_vinculada") // socorrismo, incendios, transmisiones, etc.
  formadorPrincipal String?  @map("formador_principal") // Nombre del formador/ponente habitual
  nivelFormacion    String?  @default("basico") @map("nivel_formacion") // basico, intermedio, avanzado
  modalidad         String?  @default("presencial") // presencial, online, mixto
  
  activo            Boolean  @default(true)
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  convocatorias     Convocatoria[]
  certificaciones   Certificacion[]
  necesidades       NecesidadFormativa[]
  
  @@map("cursos")
}

model Convocatoria {
  id                String   @id @default(cuid())
  cursoId           String   @map("curso_id")
  curso             Curso    @relation(fields: [cursoId], references: [id], onDelete: Cascade)
  
  codigo            String   @unique
  fechaInicio       DateTime @map("fecha_inicio")
  fechaFin          DateTime @map("fecha_fin")
  
  lugar             String?
  direccion         String?
  horario           String?  @db.Text
  instructores      String?  @db.Text
  
  plazasDisponibles Int      @map("plazas_disponibles")
  plazasOcupadas    Int      @default(0) @map("plazas_ocupadas")
  
  estado            String   @default("planificada")
  
  evaluacionRequerida Boolean @default(true) @map("evaluacion_requerida")
  notaMinima        Float?   @default(5) @map("nota_minima")
  
  actaFormacion     String?  @map("acta_formacion")
  listadoAsistencia String?  @map("listado_asistencia")
  
  // Nuevos campos de fechas y gestión
  fechaProgramacion DateTime? @map("fecha_programacion") // Cuando se planifica
  fechaPublicacion  DateTime? @map("fecha_publicacion")  // Cuando se abre al público
  formadorNombre    String?   @map("formador_nombre")    // Formador específico de esta edición
  formadorExterno   Boolean   @default(false) @map("formador_externo")
  edicion           String?   // "1ª Edición", "2ª Edición", etc.
  actaGenerada      Boolean   @default(false) @map("acta_generada")
  actaUrl           String?   @map("acta_url")
  
  observaciones     String?  @db.Text
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  inscripciones     Inscripcion[]
  jornadas          JornadaAsistencia[]
  
  @@map("convocatorias")
}

model Inscripcion {
  id                String   @id @default(cuid())
  convocatoriaId    String   @map("convocatoria_id")
  convocatoria      Convocatoria @relation(fields: [convocatoriaId], references: [id], onDelete: Cascade)
  
  usuarioId         String   @map("usuario_id")
  usuario           Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  fechaInscripcion  DateTime @default(now()) @map("fecha_inscripcion")
  estado            String   @default("pendiente")
  
  porcentajeAsistencia Float? @map("porcentaje_asistencia")
  notaFinal         Float?   @map("nota_final")
  apto              Boolean?
  
  // Campos de firma biométrica
  firmaBiometrica   String?  @map("firma_biometrica") // Datos de firma (base64 o hash)
  fechaFirma        DateTime? @map("fecha_firma") // Fecha y hora de la firma
  dispositivoFirma  String?  @map("dispositivo_firma") // Dispositivo donde se firmó (iPad, etc.)
  ipFirma           String?  @map("ip_firma") // IP del dispositivo
  
  fechaCertificacion DateTime? @map("fecha_certificacion")
  certificadoUrl    String?  @map("certificado_url")
  
  observaciones     String?  @db.Text
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  @@unique([convocatoriaId, usuarioId])
  @@map("inscripciones")
}

model Certificacion {
  id                String   @id @default(cuid())
  usuarioId         String   @map("usuario_id")
  usuario           Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  cursoId           String   @map("curso_id")
  curso             Curso    @relation(fields: [cursoId], references: [id], onDelete: Cascade)
  
  numeroCertificado String?  @unique @map("numero_certificado")
  fechaObtencion    DateTime @map("fecha_obtencion")
  fechaExpiracion   DateTime? @map("fecha_expiracion")
  
  entidadEmisora    String   @map("entidad_emisora")
  vigente           Boolean  @default(true)
  renovada          Boolean  @default(false)
  certificacionRenovacionId String? @map("certificacion_renovacion_id")
  
  certificadoUrl    String?  @map("certificado_url")
  observaciones     String?  @db.Text
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  @@map("certificaciones")
}

model NecesidadFormativa {
  id                String   @id @default(cuid())
  
  cursoId           String?  @map("curso_id")
  curso             Curso?   @relation(fields: [cursoId], references: [id], onDelete: SetNull)
  descripcion       String   @db.Text
  
  areaAfectada      String   @map("area_afectada")
  numeroPersonas    Int      @map("numero_personas")
  
  motivo            String   @db.Text
  impacto           String   @default("medio")
  urgencia          String   @default("normal")
  prioridad         Int      @default(3)
  
  fechaLimite       DateTime? @map("fecha_limite")
  estado            String   @default("identificada")
  
  convocatoriaPlanificada String? @map("convocatoria_planificada")
  fechaResolucion   DateTime? @map("fecha_resolucion")
  
  detectadaPor      String   @map("detectada_por")
  fechaDeteccion    DateTime @default(now()) @map("fecha_deteccion")
  
  observaciones     String?  @db.Text
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  @@map("necesidades_formativas")
}

// ============================================
// MODELOS REGISTRO DE ASISTENCIA Y FORMACIÓN
// ============================================

model JornadaAsistencia {
  id                String   @id @default(cuid())
  convocatoriaId    String   @map("convocatoria_id")
  convocatoria      Convocatoria @relation(fields: [convocatoriaId], references: [id], onDelete: Cascade)

  fecha             DateTime
  numeroJornada     Int      @map("numero_jornada")
  titulo            String?
  horaInicio        String?  @map("hora_inicio")
  horaFin           String?  @map("hora_fin")
  bloqueada         Boolean  @default(false)
  observaciones     String?  @db.Text

  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  firmas            RegistroFirma[]

  @@map("jornadas_asistencia")
}

model RegistroFirma {
  id                      String   @id @default(cuid())
  jornadaId               String   @map("jornada_id")
  jornada                 JornadaAsistencia @relation(fields: [jornadaId], references: [id], onDelete: Cascade)

  usuarioId               String?  @map("usuario_id")
  usuario                 Usuario? @relation("FirmasUsuario", fields: [usuarioId], references: [id], onDelete: SetNull)

  participanteExternoId   String?  @map("participante_externo_id")
  participanteExterno     ParticipanteExterno? @relation(fields: [participanteExternoId], references: [id], onDelete: SetNull)

  asistio                 Boolean  @default(false)
  firmaBase64             String?  @map("firma_base64") @db.Text
  fechaFirma              DateTime? @map("fecha_firma")

  valoracionFormador      String?  @map("valoracion_formador")
  notaFormador            Float?   @map("nota_formador")
  comentarioFormador      String?  @db.Text @map("comentario_formador")

  createdAt               DateTime @default(now()) @map("created_at")
  updatedAt               DateTime @updatedAt @map("updated_at")

  @@unique([jornadaId, usuarioId])
  @@map("registros_firma")
}

model ParticipanteExterno {
  id                String   @id @default(cuid())
  convocatoriaId    String   @map("convocatoria_id")

  nombre            String
  apellidos         String
  dni               String?
  email             String?
  telefono          String?
  organizacion      String?
  cargo             String?

  certificadoGenerado Boolean @default(false) @map("certificado_generado")
  certificadoUrl    String?  @map("certificado_url")

  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  firmas            RegistroFirma[]

  @@map("participantes_externos")
}

// ============================================
// MODELO DE AUDITORÍA / TRAZABILIDAD
// ============================================

model AuditLog {
  id              String   @id @default(cuid())
  
  // Información de la acción
  accion          String   @db.Text // CREATE, UPDATE, DELETE, LOGIN, LOGOUT, EXPORT, etc.
  entidad         String   // Nombre del modelo: Usuario, Voluntario, Evento, Caja, etc.
  entidadId       String?  @map("entidad_id") // ID del registro afectado
  
  // Datos anteriores y nuevos (JSON)
  datosAnteriores Json?   @map("datos_anteriores") // Estado anterior
  datosNuevos     Json?   @map("datos_nuevos") // Estado nuevo
  
  // Información del usuario
  usuarioId       String?  @map("usuario_id")
  usuarioEmail   String?  @map("usuario_email")
  usuarioNombre  String?  @map("usuario_nombre")
  
  // Contexto adicional
  ip             String?  @map("ip_address")
  userAgent      String?  @map("user_agent")
  
  // Metadatos
  descripcion    String?  @db.Text // Descripción legible de la acción
  modulo         String?  // Módulo del sistema: Administracion, Personal, Incendios, etc.
  
  // Timestamps
  createdAt      DateTime @default(now()) @map("created_at")
  
  @@index([createdAt])
  @@index([entidad, entidadId])
  @@index([usuarioId])
  @@index([accion])
  @@index([modulo])
  @@map("audit_logs")
}
